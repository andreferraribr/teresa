---
title: "Compras"
editor: visual
---

```{r}
# https://kbroman.org/knitr_knutshell/pages/Rmarkdown.html
knitr::opts_chunk$set( echo=FALSE, warning=FALSE, message=FALSE)
options(encoding = "latin1")
```

```{r}
library(purrr)
library(shiny)
library(tidyverse)
library(readxl)
library(DT)
library(plotly)
library(lubridate)
library(RcppRoll)
library(scales)
library(ggrepel)
library(forcats)
library(readr)
```

```{r df_licitacoes}





# licitacoes$valor <- str_remove_all(licitacoes$valor,"R")
# licitacoes$valor <- str_remove_all(licitacoes$valor,"\\$")
# licitacoes$valor <- str_replace(licitacoes$valor,"--", "0,00")
# licitacoes$valor <- str_trim (licitacoes$valor)
# licitacoes$valor <- parse_number(licitacoes$valor, locale = locale(decimal_mark = ","))
# 
# licitacoes <- licitacoes %>% mutate(ano = year(data_publicacao))

```




## Licitações




```{r licitacoes}

dados_licitacoes <- read_csv("dados_licitacoes.csv")

datatable(dados_licitacoes %>% filter(data_publicacao >= as.Date(today()-60) ) %>% group_by(objeto, data_abertura) %>% summarise(valor = sum(valor, na.rm = TRUE)) %>% arrange(desc(valor)))%>% formatCurrency("valor",
  currency = "R$",
  interval = 3,
  mark = ".",
  digits = 0,
  dec.mark = ",",
  before = TRUE,
  zero.print = NULL,
  rows = NULL)%>% 
     formatStyle(columns = colnames(.$x$data), fontSize = "10pt")
```

## Atas

```{r tabela_atas}
dados_atas <- read_csv("dados_atas.csv")
datatable(dados_atas  %>% select(objeto, fornecedor,vigencia))%>% 
     formatStyle(columns = colnames(.$x$data), fontSize = "10pt")

```

## Contratos

```{r}

dados_contratos <- read_csv("dados_contratos.csv")
datatable(dados_contratos %>% filter(vigencia_data_fim >= as.Date(today()) ) %>% group_by(objeto, fornecedor_nome, vigencia_data_fim) %>% summarise(valor = sum(valor, na.rm = TRUE)) %>% arrange(desc(valor)))%>% formatCurrency("valor",
  currency = "R$",
  interval = 3,
  mark = ".",
  digits = 0,
  dec.mark = ",",
  before = TRUE,
  zero.print = NULL,
  rows = NULL)%>% 
     formatStyle(columns = colnames(.$x$data), fontSize = "10pt")

```
